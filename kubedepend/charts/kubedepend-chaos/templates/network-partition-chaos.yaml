{{- if .Values.networkPartitionChaos.enabled -}}
{{/*
Network Partition action separates pods into several independent subnets by blocking communication between them.
*/}}
apiVersion: chaos-mesh.org/v1alpha1
kind: NetworkChaos
metadata:
  name: network-partition
spec:
  action: partition
  mode: fixed-percent
  {{- if .Values.networkPartitionChaos.strength == "low" }}
  value: {{ .Values.mode.fixPercent.low }}
  {{- else if .Values.networkPartitionChaos.strength == "high" }}
  value: {{ .Values.mode.fixPercent.high }}
  {{- else .Values.networkPartitionChaos.strength == "medium" }}
  value: {{ .Values.mode.fixPercent.medium }}
  {{- end }}
  selector:
    namespace:
      - kubedepend
  direction: both
  target:
    selector:
      namespaces:
        - kubedepend
    mode: fixed-percent
    {{- if .Values.networkPartitionChaos.strength == "low" }}
    value: 20
    {{- else if .Values.networkPartitionChaos.strength == "high" }}
    value: 35
    {{- else .Values.networkPartitionChaos.strength == "medium" }}
    value: 50
    {{- end }}
  duration: "5s"
  scheduler:
    cron: "@every 15s"
{{- end }}